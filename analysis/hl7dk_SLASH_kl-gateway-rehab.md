# kl-gateway-rehab: Analysis

## Core Purpose & Scope

This Implementation Guide (IG), `kl.dk.fhir.rehab`, addresses the interoperability challenges related to reporting §140 rehabilitation data from Danish municipalities to the KL Gateway. It solves the key business problem of standardizing the exchange of rehabilitation data originating from physiotherapist documentation in municipalities, ensuring compliance with Danish core profiles and the ongoing work on a shared information model (FKI) for municipal data. The IG's scope is specifically focused on reporting §140 rehabilitation data, which includes information about the citizen, referring organizations, service requests, focus conditions, planned interventions, care plans, encounters, and conditions. It is bounded by the information required for reporting to the KL Gateway.

## Technical Foundation

The technical foundation of the IG rests on FHIR R4 (version 4.0.1) and leverages several core profiles and extensions. Key profiles include `KLGateway140Citizen`, `KLGateway140Organization`, `KLGateway140ServiceRequest`, `KLGateway140FocusCondition`, `KLGateway140PlannedIntervention`, `KLGateway140CarePlan`, `KLGateway140Encounter`, `KLGateway140Condition`, and `KLGateway140DeliveryReport`. Notable extensions include `PreconditionDate`, `DeliveryType`, `BasedOnServiceRequestExtension`, and `BasedOnCarePlanExtension`. The IG defines several value sets, including `ServiceRequestStatusReasons140`, `ServiceRequestTypes140`, `DeliveryTypes140`, `CancellationTypes`, `CarePlanCategories140`, `ServiceTypes140`, `Conditions140`, and `EncounterClassCodes`. These value sets primarily draw from `KLCommonCodes` and `FSIII` terminologies. Significant constraints are enforced through invariants, such as those ensuring proper relationships between care plans and interventions, and the correct usage of status and status reason codes.

## Technical Essence

This IG defines a FHIR-based reporting mechanism for Danish municipal §140 rehabilitation data, centered around a `KLGateway140DeliveryReport` (a Bundle of type collection). Each report contains a `KLGateway140Citizen` (Patient) with a mandatory CPR number and managing organization SOR code, along with a set of resources representing the citizen's rehabilitation journey.  `KLGateway140ServiceRequest` captures the initial referral (GGOP) from a hospital, referencing the sending `KLGateway140Organization` (SOR or FK-org code) and linking to a `KLGateway140FocusCondition` (Condition) with an SKS diagnosis code. `KLGateway140PlannedIntervention` (CarePlan) details authorized interventions using FSIII codes and delivery types (individual, group, etc.), optionally linked to a `KLGateway140CarePlan` for grouped interventions. `KLGateway140Encounter` records citizen interactions, referencing the relevant `KLGateway140CarePlan` or `KLGateway140PlannedIntervention`. `KLGateway140Condition` tracks FSIII conditions relevant to the rehabilitation process.  Status and intent fields are strictly controlled, with specific requirements for `entered-in-error` and cancellation scenarios. The `BasedOnServiceRequestExtension` and `BasedOnCarePlanExtension` link interventions and encounters back to their originating service requests and care plans, respectively.

## Implementation Approach

The IG is designed to be implemented by systems within Danish municipalities that manage §140 rehabilitation data. The critical workflow involves creating and submitting `KLGateway140DeliveryReport` bundles to the KL Gateway. Each report must include a `KLGateway140Citizen` and any updated or new resources related to the citizen's rehabilitation process since the last report. Implementers must adhere to the defined profiles, extensions, and value sets. Key requirements include accurate mapping of data to the specified FHIR resources, proper use of status and intent fields, and adherence to the defined invariants. The IG emphasizes the importance of correctly representing the relationships between resources, such as linking interventions to service requests and encounters to care plans.

## Ecosystem Context

The target systems for this IG are those used by Danish municipalities to manage §140 rehabilitation data, and the target users are primarily healthcare professionals and administrators involved in the rehabilitation process. The IG is specifically designed for the Danish healthcare ecosystem and is relevant to programs and initiatives related to §140 rehabilitation. It relates to other standards and IGs, including `hl7.fhir.dk.core` and `kl.dk.fhir.term`, on which it has dependencies. The primary use cases involve reporting rehabilitation data to the KL Gateway, supporting data analysis, quality monitoring, and potentially informing policy decisions related to §140 rehabilitation services. The example provided, detailing the reporting for the citizen "Ruddi Test Berggren," illustrates the intended use of the IG in a real-world scenario.
