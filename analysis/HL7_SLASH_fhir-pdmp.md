# fhir-pdmp: Analysis

## Core Purpose & Scope

This FHIR Implementation Guide (IG) addresses the interoperability challenges associated with accessing and exchanging patient prescription drug monitoring program (PDMP) data between disparate systems in the United States. It aims to solve the clinical and business problems of drug misuse, diversion, and patient safety by enabling providers to efficiently retrieve and review a patient's controlled substance prescription history. The scope is limited to defining a standardized method for PDMP Requesters (e.g., EHRs, pharmacy systems) to query PDMP Responders (e.g., state PDMP systems) for patient PDMP history, including both discrete data and formatted reports. It does not address other interactions within the broader PDMP ecosystem, such as prescription dispensation reporting or data exchange between PDMPs.

## Technical Foundation

The IG's technical foundation is built upon core FHIR resources, profiles, and extensions. Key profiles include `pdmp-patient`, `pdmp-medicationdispense`, and `pdmp-organization-pharmacy`, which are based on US Core profiles. It defines a `pdmp-history` operation for requesting and retrieving PDMP data, with associated `pdmp-parameters-request` and `pdmp-parameters-response` profiles. The response can include a `pdmp-bundle-history-result` containing discrete FHIR resources or a URL to a formatted report. Notable extensions include `pdmp-extension-rx-fill-number`, `pdmp-extension-rx-transmission-method`, `pdmp-extension-mme`, `pdmp-extension-method-of-payment`, and `pdmp-extension-opioid-treatment-code`. Key terminology includes value sets for opioid treatment codes, patient alert categories, and response status codes, primarily sourced from PMIX. The IG also supports FHIR messaging using `pdmp-bundle-request-message` and `pdmp-bundle-response-message` profiles.

## Technical Essence

This IG defines a standardized mechanism for retrieving patient PDMP history via a `pdmp-history` operation or FHIR messaging. A PDMP Requester initiates a request by POSTing a `pdmp-parameters-request` resource to the `Patient/$pdmp-history` endpoint or within a `pdmp-bundle-request-message`. This Parameters resource includes a `pdmp-patient` profile instance (based on US Core Patient) identifying the patient, along with details about the authorized practitioner and their organization (using US Core Practitioner, PractitionerRole, and Organization profiles). The PDMP Responder processes the request and returns a `pdmp-parameters-response` resource. If data is found, this includes either a `pdmp-bundle-history-result` containing discrete FHIR resources (including `pdmp-medicationdispense`, `pdmp-medicationadministration`, and `pdmp-organization-pharmacy` profiles) representing the patient's PDMP history, or a URL to a formatted report in the `pdmp-history-link` parameter, or both. The response also includes an `OperationOutcome` resource in the `outcome` parameter to communicate processing status, errors, or warnings, utilizing codes from the `pdmp-response-status` value set. The `pre-stage-only` parameter allows for a two-step retrieval process.

## Implementation Approach

The IG is designed to be implemented by PDMP Requesters and Responders. Critical workflows involve the Requester submitting a PDMP history request using either a direct operation call or FHIR messaging, and the Responder returning the history as discrete data, a URL link, or both. The IG mandates support for JSON resource formats and recommends the use of SMART Backend Services Authorization Guide for authentication and authorization. It defines specific handling for missing data, including the use of the `dataAbsentReason` extension. The IG emphasizes the importance of populating key elements in the `pdmp-medicationdispense` and `pdmp-medicationadministration` profiles, such as medication codes, performer, authorizing prescription, quantity, and days supply.

## Ecosystem Context

The primary target systems are EHRs, pharmacy systems, and state PDMP systems within the United States. The intended users are prescribers and pharmacists. The IG relates to other standards such as NCPDP SCRIPT, ASAP, and PMIX/NIEM, and includes mappings to these standards. It is relevant to state-based PDMP programs and aims to support compliance with jurisdictional requirements. The primary use cases involve providers requesting and reviewing patient PDMP history during clinical encounters, particularly when prescribing or dispensing controlled substances. The IG also supports scenarios involving veterinary patients and delegates acting on behalf of authorized practitioners.
