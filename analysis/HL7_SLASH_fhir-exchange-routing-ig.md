# fhir-exchange-routing-ig: Analysis

## Core Purpose & Scope

-   **Primary interoperability challenges this IG addresses:** This IG tackles the challenge of routing FHIR RESTful interactions through intermediaries (e.g., clearinghouses, HIEs) in a way that is transparent to the originating system. It enables a hybrid model where both point-to-point and intermediary-facilitated exchanges can occur without requiring the client to know which model is in use.
-   **Key clinical/business problems it solves:** It allows healthcare organizations to leverage intermediaries for benefits like cloud scalability, technical outsourcing, security services, and operational support while maintaining a consistent FHIR interface for originators. This simplifies integration for originators and allows destinations to utilize intermediary services without impacting interoperability.
-   **Intended scope and boundaries:** The IG focuses on exchanges where the originator is unaware of the intermediary's involvement, trust is established between the originator and destination, and intermediaries passively convey security tokens. It supports all RESTful FHIR interaction types within this context. It explicitly excludes scenarios where trust is established with the intermediary instead of the destination, the originator uses a non-public URL, or intermediaries rewrite URLs. It also does not cover FHIR Messaging.

## Technical Foundation

-   **Core profiles and extensions:** This IG does not define specific FHIR resource profiles or extensions. It focuses on the interaction patterns and routing mechanisms.
-   **Notable operations and interactions:** The IG supports all standard FHIR RESTful interactions (GET, POST, PUT, DELETE, etc.) and the FHIR Asynchronous Request pattern. Key interactions involve the originator sending a request to the destination's public FHIR service base URL, the intermediary routing the request, and the destination responding using its public URL.
-   **Key terminology and value sets:** The IG uses standard FHIR terminology and does not define new value sets.
-   **Significant patterns and constraints:** The core pattern is the "passive intermediary" model, where the intermediary acts like a reverse proxy. Key constraints include:
    -   The destination **SHALL** have a single public FHIR service base URL.
    -   The destination **SHALL** use its public URL in references within returned FHIR resources.
    -   Intermediaries **SHALL** pass through requests and responses unchanged, except for potential routing headers.
    -   Intermediaries **SHALL** pass through HTTP status codes from the destination unchanged.
    -   Security tokens generated by the destination **SHALL** be forwarded by the intermediary to the originating client.

## Technical Essence

This IG enables transparent routing of FHIR RESTful interactions through intermediaries by mandating that destinations use a single, publicly resolvable FHIR service base URL, regardless of intermediary involvement. Originators send requests to this public URL, which resolves to an inbound gateway intermediary. This intermediary, along with any delegated intermediaries, forwards the request based on pre-configured routing rules (e.g., URL path segments, HTTP headers) to the destination. The destination processes the request and responds, ensuring all self-references within returned resources (e.g., `Bundle.entry.fullUrl`, `Content-Location`) use the same public FHIR service base URL. Intermediaries pass through responses and HTTP status codes unchanged, maintaining the illusion of a direct connection for the originator. Security is handled via a pass-through model, with intermediaries forwarding security tokens between the originator and destination, which are responsible for trust establishment. Asynchronous requests are supported by forwarding the `Prefer: respond-async` header and the resulting `Content-Location` for status polling.

## Implementation Approach

-   **Critical workflows and interactions:**
    -   Originator obtains the destination's public FHIR service base URL.
    -   Originator initiates a RESTful interaction (synchronous or asynchronous).
    -   Inbound gateway intermediary receives the request.
    -   Intermediary routes the request to the destination (potentially through other intermediaries).
    -   Destination processes the request and returns a response, using its public URL in self-references.
    -   Intermediary passes through the response to the originator.
    -   For asynchronous requests, the originator polls the `Content-Location` for status and retrieves the response data.
-   **Important requirements and guardrails:**
    -   Destinations and intermediaries must establish business arrangements and configure routing mechanisms beforehand.
    -   The destination's public FHIR service base URL must be agreed upon and configured to resolve to the inbound gateway intermediary.
    -   Intermediaries must forward requests and responses without modification, except for potential routing headers.
    -   HTTP status codes from the destination must be passed through unchanged.
-   **Notable design choices and patterns:**
    -   The use of a single public FHIR service base URL for the destination, regardless of intermediary involvement.
    -   The passive intermediary model, where intermediaries act like reverse proxies.
    -   The pass-through security model, where trust is established between the originator and destination.

## Ecosystem Context

-   **Target systems and users:** Originating systems (e.g., provider systems, payers), destination systems (e.g., payers, providers, hospitals), and intermediaries (e.g., clearinghouses, HIEs).
-   **Relationship to other standards/IGs:** This IG complements existing FHIR standards and IGs, particularly those related to security (FHIR Security, UDAP), RESTful interactions, and asynchronous requests (Bulk Data Access). It references the FHIR specification for security and privacy considerations.
-   **Relevant jurisdictions or programs:** Initially created for the US Realm but applicable anywhere it provides value. Potentially relevant to initiatives like the Da Vinci Project and other HL7 accelerators (CARIN, Gravity).
-   **Primary use cases and scenarios:** Payer/provider data exchange, value-based care scenarios, and other situations where intermediaries are used to facilitate FHIR interactions. The IG supports both synchronous and asynchronous exchanges, including bulk data access.
