File: repos/medcomdk_SLASH_dk-medcom-acknowledgement/sushi-config.yaml

id: medcom.fhir.dk.acknowledgement
canonical: http://medcomfhir.dk/ig/acknowledgement
name: MedComAcknowledgement
title: "DK MedCom acknowledgement"
description: The DK MedCom acknowledgement IG
status: active
version: "2.0.3"
fhirVersion: 4.0.1
copyrightYear: 2021+
releaseLabel: Release
publisher:
  name: MedCom
  url: http://www.medcom.dk
jurisdiction: urn:iso:std:iso:3166#DK "Denmark"
dependencies:
  hl7.fhir.dk.core: 2.0.0
  medcom.fhir.dk.core: 2.0.0
  medcom.fhir.dk.messaging: 2.2.0
  medcom.fhir.dk.terminology: 1.4.0



menu:
  Table of Contents: toc.html
  Home: index.html
  Profiles: profiles.html
  Extensions: extensions.html
  Artifacts: artifacts.html
  Downloads: downloads.html

parameters:
  apply-contact: true
  apply-jurisdiction: true
  apply-publisher: true


---

// File: input/pagecontent/downloads.md

The following sections lists various links and artifacts that may be useful during development

### Tools, frameworks and supported programming languages
- See [https://hl7.org/fhir/R4/downloads.html](https://hl7.org/fhir/R4/downloads.html)

### Examples

Autogenerated examples are available for download:

- [XML](examples.xml.zip)
- [JSON](examples.json.zip)

### Downloadable Copy of schematrons

A downloadable version of profiles, valuesets and other profiles used in this IG is available for download (npm format):

- [Downloadable Copy](package.tgz)

---

// File: input/pagecontent/Enclosing_envelope_for_FHIR-messages.md

### Enclosing envelope for_distribution of FHIR-messages

---

### Introduction

In the mode of transport, MedCom's FHIR messages will be packaged and appear in various envelope formats.
At present, messages are sent in the existing VANS network and therefore in a VANSenvelope unless otherwise specified under the individual standard. Reception can either be in VANSenvelope or another reception envelope, ig. KOMBITs BeskedFordeler nevelope.
NB: When the modernised infrastructure is implemented, it will use new transmittal envelope that will replace the VANSenvelope. This means that this document will be updated with the new envelope format at that time. In the transition period, both the VANSenvelope and the new envelope will be used. It will be clearly explained how this should be handled.

---

### Enclosing envelopes

---

#### VANSenvelope

In relation to MedCom's new FHIR messages, VANSenvelope contains 3 elements (fields) which are influenced by FHIR as a new message type. These are contained in the following enclosing element: “VANSEnvelope/Message/MetaInformation/Document/”.

The elements are:

- Format
- Name
- Version

MedCom's FHIR messages are handled like all other messages in VANSenvelope by encoding the message base-64 in the element "VANSEnvelope/Message/Data/"

In the Transport element, "VANSEnvelope/Message/MetaInformation/Transport", the element "TransformMessage" is handled as usual, while "ServiceTag" with the attribute name = "MCM:MIME" can be specified with the following values:

- application/fhir+xml
- application/fhir+json

depending on the format the FHIR message is formatted in.

---

##### Format

The format will be the same as "Standard type" in MedCom's standard catalogue and is defined for all FHIR standards for "HL7".

---

##### Name

Name will be the same as "Type no." in MedCom's standard catalogue and will thus vary from message type to message type. Name will be prefixed with MCM: and it will, in addition, be possible to postfix it with statistical variants of a given message type. As in the GGOP standard, you can select for example GGOP1, GGOP2 and GGOP3. Similar solutions will occur as long as the FHIR messages are transported in the VANSenvelope.

---

#### Version

Version will be the same as "Version" in MedCom's standard catalogue and will thus vary from message version to message version.

---

### FHIR message types
Specifically, the above-mentioned means the following for MedCom's FHIR messages

---

#### CareCommunication

---

- Envelope: VANSenvelope
- Format: ”HL7”
- Name: ”MCM:FDIS91#<postfix value>”
- Version: ”1.0”

Postfix values for Name will be within this enumeration, which is taken from CareCommunication’s ValueSet for categories: 
https://build.fhir.org/ig/hl7dk/dk-medcom/ValueSet-medcom-careCommunication-categories.html 
Name can explicitly be taken from the following Valueset:  https://build.fhir.org/ig/hl7dk/dk-medcom/ValueSet-medcom-messaging-vansStatisticalCodeCombinations.html

---

#### HospitalNotification

---

- Envelope for sending: VANSenvelope
- Envelope for reception: KOMBITs BeskedFordeler (The Municipality Message distribution system) envelope for Municipality systems like the Electronic Homecare Records (“EOJ” systems) and SAPA.
- Format: ”HL7”
- Name: ”MCM:FDIS20#<postfix value>”
- Version: ”1.0”

Postfix values for Name will be within this enumeration, which is taken from HospitalNotification’s ValueSet: MedCom Hospital Notification Message Activity Codes: https://build.fhir.org/ig/hl7dk/dk-medcom/ValueSet-medcom-hospitalNotification-messageActivities.html 
Name can explicitly be taken from the following Valueset:  https://build.fhir.org/ig/hl7dk/dk-medcom/ValueSet-medcom-messaging-vansStatisticalCodeCombinations.html 

---

#### Acknowledgement

---

- Envelope: VANSenvelope 
- Format: ”HL7”
- Name: ”MCM:FCTL#<postfix value>”
- Version: ”1.0”

Postfix values for Name will be within this enumeration, which is taken from Response Code ValueSet: Codes: 
http://hl7.org/fhir/R4/valueset-response-code.html 
Name can explicitly be taken from the following Valueset:  https://build.fhir.org/ig/hl7dk/dk-medcom/ValueSet-medcom-messaging-vansStatisticalCodeCombinations.html


---

// File: input/pagecontent/Forsendelseskuvert_for_FHIR-meddelelser.md

### Indledning

MedComs FHIR\-meddelelser vil undervejs i deres forsendelsesforløb blive indpakket og optræde i forskellige kuvertformater.

Pt. vil afsendelse ske i det eksisterende VANS\-net og dermed med brug af VANSenvelope medmindre andet er specificeret under den enkelte standard. Modtagelse kan være både i VANSenvelope eller i anden modtagelseskuvert, f.eks. KOMBITs BeskedFordeler kuvert.

Obs. Når moderniseret infrastruktur bliver implementeret, vil den trække på en ny forsendelseskuvert, der vil erstatte VANSenvelope, så dette dokument vil til den tid blive opdateret med det nye kuvertformat. I en overgangsperiode vil både VANSenvelope og den nye kuvert blive anvendt, men der vil komme tydelige præciseringer af, hvorledes dette kommer til at foregå.

---

### Forsendelseskuverter

#### VANSenvelope

VANSenvelope indeholder ift. MedComs nye FHIR\-meddelelser 3 elementer(felter), som influeres af FHIR som ny meddelelsestype. Disse indeholdes i følgende overordnede element "VANSEnvelope/Message/MetaInformation/Document/".

De indeholdte elementer er:

- Format
- Name
- Version

MedComs FHIR\-meddelelser håndteres i øvrigt som alle andre meddelelser i VANSenvelope ved at selve meddelelsen base\-64 encodes i elementet "VANSEnvelope/Message/Data/"

I Transportelementet, "VANSEnvelope/Message/MetaInformation/Transport", håndteres elementet "TransformMessage" som vanligt, mens "ServiceTag" med attributten name="MCM:MIME" kan angives med følgende værdier:

- application/fhir+xml
- application/fhir+json

afhængigt af, hvilket format FHIR\-meddelelsen er formateret i.

---

##### Format

Format bliver samme som "Standard type" i MedComs standardkatalog og defineres for alle FHIR\-standarder til "HL7".

---

###### Name

Name bliver samme som "Type nr." i MedComs standardkatalog og vil dermed variere fra meddelelsestype til meddelelsestype. Name prefixes med MCM: og vil i øvrigt kunne postfixes med statistiske varianter af en given meddelelsestype. Kendt fra GGOP kan dette udfaldsrum f.eks. være GGOP1, GGOP2 og GGOP3. Lignende konstruktioner vil forekomme så længe FHIR\-meddelelser transporteres i VANSenvelope.

---

##### Version

Version bliver samme som "Version" i MedComs standardkatalog og vil dermed variere fra meddelelsesversion til meddelelsesversion.

---

### FHIR meddelelsestyper

Konkret betyder ovenstående for MedComs FHIR\-meddelelser dette

---

#### CareCommunication

---

- Kuvert: VANSenvelope
- Format:  "HL7"
- Name:    "MCM:FDIS91#`<code>`"
- Version: "1.0"

Postfixværdier for Name vil være indenfor dette code udfaldsrum, som er taget fra: [CareCommunications ValueSet for categories](https://build.fhir.org/ig/hl7dk/dk-medcom/ValueSet-medcom-careCommunication-categories.html)

Name kan eksplicit tages fra følgende Valueset: [VANS StatisticalCode Combinations](https://build.fhir.org/ig/hl7dk/dk-medcom/CodeSystem-medcom-messaging-sorEdiSystem.html)

---

#### HospitalNotification

---

- Kuvert for afsendelse: VANSenvelope
- Kuvert for modtagelse: KOMBITs BeskedFordeler kuvert for kommunale systemer som EOJ-systemerne og SAPA
- Format:  "HL7"
- Name:    "MCM:FDIS20#`<code>`"
- Version: "1.0"

Postfixværdier for Name vil være indenfor dette code udfaldsrum, som er taget fra HospitalNotifications ValueSet: MedCom Hospital Notification Message Activity Codes:  [https://build.fhir.org/ig/hl7dk/dk-medcom/ValueSet-medcom-hospitalNotification-messageActivities.html](https://build.fhir.org/ig/hl7dk/dk-medcom/ValueSet-medcom-hospitalNotification-messageActivities.html)

Name kan eksplicit tages fra følgende Valueset: [https://build.fhir.org/ig/hl7dk/dk-medcom/ValueSet-medcom-messaging-vansStatisticalCodeCombinations.html](https://build.fhir.org/ig/hl7dk/dk-medcom/ValueSet-medcom-messaging-vansStatisticalCodeCombinations.html)

---

#### Acknowledgement

---

- Kuvert: VANSenvelope i afsendelse,
- Format:  "HL7"
- Name:    "MCM:FCTL#`<code>`"
- Version: "1.0"

Postfixværdier for Name vil være indenfor dette code udfaldsrum, som er taget fra Response Code ValueSet: Codes:  [http://hl7.org/fhir/R4/valueset-response-code.html](http://hl7.org/fhir/R4/valueset-response-code.html)

Name kan eksplicit tages fra følgende Valueset: [https://build.fhir.org/ig/hl7dk/dk-medcom/ValueSet-medcom-messaging-vansStatisticalCodeCombinations.html](https://build.fhir.org/ig/hl7dk/dk-medcom/ValueSet-medcom-messaging-vansStatisticalCodeCombinations.html)



---

// File: input/pagecontent/index.md


### Introduction

This implementation guide (IG) is provided by MedCom to describe the use of FHIR &reg;&copy; Acknowledgement in message based exchange of data in Danish healthcare. 

A MedCom Acknowledgement message (Danish: Kvittering) corresponds to a receipt of a delivered message. Every time a system receives a MedCom FHIR message, e.g. a [HospitalNotification](http://medcomfhir.dk/ig/hospitalnotification/) or a [CareCommunication](http://medcomfhir.dk/ig/carecommunication/), it shall be acknowledged with a MedCom Acknowledgement message, stating if the transfer was successful and the message validated correctly or not. In other word, does a MedCom Acknowledgement message hold information about how delivery of a message went. MedCom FHIR messaging complies with [reliable messaging and associated governance](https://medcomdk.github.io/MedCom-FHIR-Communication/#network-layer), which describes the value and needs of acknowledge all messages. 

#### Acknowlegdement message

The following diagram depicts the structure of the Acknowledgement message.

<img alt="MedComAcknowledgementMessage is the root profile. From this is the MedComMessagingProvenance and MedComAcknowledgementMessageHeader referenced. The MedComAcknowledgementMessageHeader includes references to the MedComMessagingOrganization. Additionally, it is possible to include an OperationOutCome profile, referenced from MedComAcknowledgementMessageHeader." src="./MedComAcknowledgementMessage.svg" style="float:none; display:block; margin-left:auto; margin-right:auto;" />

The Acknowledgement message follows the general MedCom FHIR messaging structure, except that the carbon-copy destination is not allowed. The following sections describe the overall purpose of each profile.

#### MedComAcknowledgementMessage

A [MedComAcknowledgementMessage](http://medcomfhir.dk/ig/acknowledgement/StructureDefinition-medcom-messaging-acknowledgement.html) is inherited from [MedComMessagingMessage](http://medcomfhir.dk/ig/messaging/StructureDefinition-medcom-messaging-message.html), and constrains the profile since the MessageHeader shall be of the type MedComAcknowledgementMessageHeader.

#### MedComAcknowledgementMessageHeader

[MedComAcknowledgementMessageHeader](http://medcomfhir.dk/ig/acknowledgement/StructureDefinition-medcom-messaging-acknowledgementHeader.html) is inherited from [MedComMessagingMessageHeader](http://medcomfhir.dk/ig/messaging/StructureDefinition-medcom-messaging-messageHeader.html), and constrains the profile as carbon-copy is not allowed and it requires a respones code, which states if the delivery of the message went well or not.

An Acknowledgement message is required in MedCom FHIR Messaging and follows the recommandations from HL7 FHIR ValueSet [response-code](http://hl7.org/fhir/R4/valueset-response-code.html). 

#### MedComAcknowledgementOperationOutcome

[MedComAcknowledgementOperationOutcome](http://medcomfhir.dk/ig/acknowledgement/StructureDefinition-medcom-acknowledgement-operationoutcome.html) shall be included in the bundle when the MessageHeader.response.code is different from 'ok'. Further, an OperationOutcome resource may be included when the MessageHeader.response.code is 'ok', e.g. in cases where the received message is valid, but it is a dublet. OperationOutcome contains a description of the error and the severity of the error.

The ValueSet [MedComAcknowledgementIssueDetailValues](http://medcomfhir.dk/ig/terminology/ValueSet-medcom-acknowledgement-issue-details.html) attached to the element OperationOutcome.response.detail.coding is used to describe the issue more detailed. Currently, the ValueSet is fairly empty, as MedCom wants input from IT-vendors on which codes give values in their systems. Across sectors there must be an agreed list of codes.

#### Timestamps 

The Acknowledgement message contains three timestamps:

* Bundle.timestamp
* Provenance.occuredDateTime[x]
* Provenance.recorded.

The three timestamps are registered at different time during Acknowledgement message generation and sending. The Acknowledgement message is sent when a system receives a FHIR message e.g. when a municipality receives a HospitalNotification message from the hospital, the it-system will evaluate the message. Based on the result from the evaluation, the system will generate an acknowlegement message that represet the evaluation results. This means that if the HospitalNotification is evaluated positive the acknowlegdement is as well positive. Whereas if the HospitalNotification is evaluated negative then a negative Acknowledgement is generated and send. When the acknowledgement message is generated a Bundle.timestamp is registered. When the acknowledgement message is sent the Provenance.occuredDateTime[x] and Provenance.recorded time stamp is registered. Note that the Provenance.occuredDateTime[x] is a human redable, where Provenance.recorded is a system readable.

#### Simplified examples of the Acknowledgement messages

The simplified examples contain the required content of an Acknowledgement message. The messages illustrate an OK response and a fatal-error response based on a received message. The illustrations shows that two provenance resouces are included when sending an Acknowledgement message, one for the messages the is being acknowledged and one for the Acknowledgement message. 

All profiles shall have a global unique id by using an UUID. [Read more about the use of ids here](https://medcomdk.github.io/MedCom-FHIR-Communication/assets/documents/052.2_MessageHeader_Identifiers_Timestamps.html).

[More examples of a Acknowledgement message can be found here](http://medcomfhir.dk/ig/acknowledgement/StructureDefinition-medcom-messaging-acknowledgement-examples.html). For examples of a profile, take a look under the tab 'Examples' on the site for the given profile.

> Please notice, that in the following examples is the Provenance resources listed as an array. This is just an example of an order, resources may be listed in any order. 

* [Simplified example of a MedComAcknowledgementMessage responding with OK](./AcknowledgementOK.svg)
* [Simplified example of a MedComHospitalNotificationMessage responding with fatal-error.](./AcknowledgementError.svg)


#### Terminology
On [MedCom Terminology IG](http://medcomfhir.dk/ig/terminology/) all referenced CodeSystem and ValueSets developed by MedCom can be found.

#### Dependencies
This IG has a dependency to the [MedCom Core IG](http://medcomfhir.dk/ig/core/), [MedCom Messaging IG](http://medcomfhir.dk/ig/messaging/) and [DK-core v. 2.0.0](https://hl7.dk/fhir/core/), where the latter is defined by [HL7 Denmark](https://hl7.dk/). This is currently reflected in the profiles MedComAcknowledgementMessage, and MedComAcknowledgementMessageHeader which both inherits from profiles defined in MedCom Messaging IG. 

### Documentation

On the [introduction page for Acknowledgement](https://medcomdk.github.io/dk-medcom-acknowledgement/) an introduction and use cases can be found.

### Governance

MedComs FHIR profiles and extension are managed in GitHub under MedCom: [Source code](https://github.com/medcomdk/dk-medcom-acknowledgement)

A description of [governance concerning change management and versioning](https://medcomdk.github.io/MedComLandingPage/#4-change-managment-and-versioning) of MedComs FHIR artefacts, can be found on the link.

#### Quality Assurance Report

In the Quality Assurance report (QA-report) for this IG, there is an error with the following description: *Reference is remote which isn’t supported by the specified aggregation mode(s) for the reference (bundled)*. The error occurs when creating instances of the profiles and is due to some elements having a Bundled flag {b}, however the referenced profile in the element is not included in the Bundle in an instance, since the instance only represents a part of the entire message. This will not influence the implementation by IT-vendors.

### Contact 

[MedCom](https://www.medcom.dk/) is responsible for this IG.

If you have any questions, please contact <fhir@medcom.dk> or write to MedCom's stream in [Zulip](https://chat.fhir.org/#narrow/stream/315677-denmark.2Fmedcom.2FFHIRimplementationErfaGroup).


---

// File: input/pagecontent/StructureDefinition-medcom-acknowledgement-message-definition-intro.md

### Scope and usage 

This MessageDefinition profile defines the characteristics of a message that can be shared between systems.
This profile should not be included in the exchange of an Acknowledgement message, but can be used to extract relevant information concerning the message, for usage in the VANSEnvelope. The MedComAcknowledgementMessageHeader profile includes an required url to this profile in the element MessageHeader.definition. 


---

// File: input/pagecontent/StructureDefinition-medcom-acknowledgement-operationoutcome-intro.md

### Scope and usage 
This profile is called MedComAcknowledgementOperationOutcome and is used to give a detailed describtion of errors occuring when exchanging FHIR messages. Succes or fail in message exchange can be found in the element MessageHeader.response.code. 
MedComAcknowledgementOperationOutcome can be seen as a help for IT-vendors to identify potential errors in their systems, as it least shall contain a description of the issue, including a severity and an error or warning code. It may include several issues. 

Please refer to the tab "Snapshot Table(Must support)" below for the definition of the required content of a MedComAcknowledgementMessage.

#### When to include an OperationOutcome

MedComAcknowledgementOperationOutcome should not be included when the message exchange goes well, corresponding to the value 'ok' in MessageHeader.response.code. However, may be included when the MessageHeader.response.code is 'ok', e.g. in cases where the received message is valid, but it is a dublet of a previous sent message. In this case an OperationOutcome with a value of OperationOutcome.issue.severity 'information' and a relevant code could be included. 
An OperationOutcome resource shall be included when the element MessageHeader.response.code is different from 'ok'.  

#### OperationOutCome.issue.details.coding

The CodeSystem [MedComAcknowledgementIssueDetails](http://medcomfhir.dk/ig/terminology/CodeSystem-medcom-acknowledgement-issue-details.html)and ValueSet[MedComAcknowledgementIssueDetailValues](http://medcomfhir.dk/ig/terminology/ValueSet-medcom-acknowledgement-issue-details.html) used in the element OperationOutCome.issue.details.coding are used to describe the issue of receiving a message more detailed. Currently, the two terminologies are fairly empty, as MedCom wants input from IT-vendors on which issue codes provide value in IT-systems. Across sectors there must be an agreed list of codes. Therefore, the ValueSet has a status as 'draft' and vendors should expect the CodeSystem and ValueSet to be extended. [For relevant input regarding the issue codes, please contact MedCom](http://medcomfhir.dk/ig/acknowledgement/#contact).



---

// File: input/pagecontent/StructureDefinition-medcom-messaging-acknowledgement-intro.md

### Scope and usage 
This profile is the root profile of MedCom Acknowledgement message. Constraint and rules from MedComMessagingMessage are inherited to this profile. The only change is that the MessageHeader shall be a MedComAcknowledgementMessageHeader. 

__Note:__ Be aware that entries in a message in general are unordered. Recipients of a message can therefore not assume any particular sequences of elements.

Below can the structure of a MedCom Acknowledgement message be seen.

<img alt="MedComAcknowledgementMessage is the root profile. From this is the MedComMessagingProvenance and MedComAcknowledgementMessageHeader referenced. The MedComAcknowledgementMessageHeader includes references to the MedComMessagingOrganization. Additionally, it is possible to include an OperationOutCome profile, referenced from MedComAcknowledgementMessageHeader." src="./MedComAcknowledgementMessage.svg" style="float:none; display:block; margin-left:auto; margin-right:auto;" />

Please refer to the tab "Snapshot Table(Must support)" below for the definition of the required content of a MedComAcknowledgementMessage.


---

// File: input/pagecontent/StructureDefinition-medcom-messaging-acknowledgementHeader-intro.md

### Scope and usage 
This profile is used as the MessageHeader resource for the MedCom Acknowledgement message. 
Constraint and rules from MedComMessagingMessageHeader is inherited to this profile. However, does MedComAcknowledgementMessageHeader not allow for a receiver of the type carbon-copy and the profile requires a response code. This code includes information about the delivery of a message e.g., if the message was delivered without error it would resolve in response code 'ok'.   

Below can the structure of a MedCom AcknowledgementMessageHeader be seen.

<img alt="The MedComAcknowledgementMessageHeader includes references to the MedComMessagingOrganization. Additionally, it is possible to include an OperationOutCome profile, referenced from MedComAcknowledgementMessageHeader." src="./AcknowledgementMessageHeader.svg" style="float:none; display:block; margin-left:auto; margin-right:auto;" />

Please refer to the tab "Snapshot Table(Must support)" below for the definition of the required content of a MedComAcknowledgementMessageHeader.

### Respons code

A MedComAcknowledgementMessageHeader is required in MedCom FHIR Messaging and follows the recommandations from HL7 FHIR ValueSet [response-code](http://hl7.org/fhir/R4/valueset-response-code.html "response-code") 

The codes here are equivalent to HL7 v3.Acknowledgement as described in the table below.

HL7 FHIR Code | HL7 FHIR Code Display | HL7 FHIR Definition | HL7 v3 Code | HL7 v3 Code Display | HL7 v3 Definition
----------------- | ------------------------  | ---------------------- | -------------- | ------------- | -------------
ok | OK | The message was accepted and processed without error. | AA | Application Acknowledgement Accept | Receiving application successfully processed message.
fatal-error | Fatal Error | The message was rejected because of a problem with the content. There is no point in re-sending without change. The response narrative SHALL describe the issue. | AE | Application Acknowledgement Error | Receiving application found error in processing message. Sending error response with additional error detail information.
transient-error | Transient Error | Some internal unexpected error occurred - wait and try again. Note - this is usually used for things like database unavailable, which may be expected to resolve, though human intervention may be required. | AR | Application Acknowledgement Reject | Receiving application failed to process message for reason unrelated to content or format. Original message sender must decide on whether to automatically send message again.

Please go to this definition of [OperationOutcome](http://hl7.org/fhir/R4/operationoutcome.html#resource) to get informed how and when to use if the code response is different from "OK".


---

// File: input/fsh/AcknowledgementProvenanceInstances.fsh

Instance: 4c284936-5454-4116-95fc-3c8eeeed2400
InstanceOf: MedComMessagingProvenance
Title: "CareCommunication example. The Provenance instance is only valid if used in a bundle (message) - new message"
Description: "CareCommunication example. The Provenance instance is only valid if used in a bundle (message) - new message"
* target = Reference(42cb9200-f421-4d08-8391-7d51a2503cb4)
* occurredDateTime = 2022-09-01T12:01:20+02:00
* recorded = 2022-09-01T12:01:20Z
* activity.coding = $ActivityCode#new-message
* agent.who = Reference(d7056980-a8b2-42aa-8a0e-c1fc85d1f40d)

Instance: 69dab277-dd4b-4055-9fda-a10a65cb4412
InstanceOf: MedComMessagingProvenance
Title: "Provenance information for an Acknowledgement message - CareCommunication. Valid only if used in a bundle (message)"
Description: "Provenance information for an Acknowledgementmessage - CareCommunication. Valid only if used in a bundle (message)."
* target = Reference(aba2d9bf-2c6c-47e8-bce4-7928bcd51019)
* occurredDateTime = 2022-09-01T12:01:20+02:00
* recorded = 2022-09-01T12:01:20Z
* activity.coding = $ActivityCode#acknowledgement
* agent.who = Reference(74cdf292-abf3-4f5f-80ea-60a48013ff6d)
* entity.role = #revision
* entity.what = Reference(42cb9200-f421-4d08-8391-7d51a2503cb4)

Instance: 9c56ba88-9645-11ec-b909-0242ac120002
InstanceOf: MedComMessagingProvenance
Title: "Provenance information for an Acknowledgement message - CareCommunication. Valid only if used in a bundle (message)"
Description: "Provenance information for an Acknowledgementmessage - CareCommunication. Valid only if used in a bundle (message)."
* target = Reference(b879c81e-0607-4ccb-b358-24a72208e30d)
* occurredDateTime = 2022-09-01T12:01:20+02:00
* recorded = 2022-09-01T12:01:20Z
* activity.coding = $ActivityCode#acknowledgement
* agent.who = Reference(74cdf292-abf3-4f5f-80ea-60a48013ff6d)
* entity.role = #revision
* entity.what = Reference(42cb9200-f421-4d08-8391-7d51a2503cb4)

Instance: 9b56aa88-9745-12ec-b919-0242ac122002
InstanceOf: MedComMessagingProvenance
Title: "Provenance information for an Acknowledgement message - CareCommunication. Valid only if used in a bundle (message)"
Description: "Provenance information for an Acknowledgementmessage - CareCommunication. Valid only if used in a bundle (message)."
* target = Reference(c9a0b728-0807-11ed-861d-0242ac120002)
* occurredDateTime = 2022-09-01T12:01:20+02:00
* recorded = 2022-09-01T12:01:20Z
* activity.coding = $ActivityCode#acknowledgement
* agent.who = Reference(74cdf292-abf3-4f5f-80ea-60a48013ff6d)
* entity.role = #revision
* entity.what = Reference(42cb9200-f421-4d08-8391-7d51a2503cb4)

---

// File: input/fsh/aliases.fsh

Alias: $StatusCodes = http://hl7.org/fhir/encounter-status
Alias: $ActCodes = http://terminology.hl7.org/CodeSystem/v3-ActCode
Alias: $BundleType = http://hl7.org/fhir/bundle-type
Alias: $MessageEvents = http://medcomfhir.dk/ig/terminology/CodeSystem/medcom-messaging-eventCodes
Alias: $Use = http://medcomfhir.dk/ig/terminology/CodeSystem/medcom-messaging-destinationUse
Alias: $AcknowledgementCode = http://hl7.org/fhir/ValueSet/Acknowledgement-code
Alias: $ServerityCode = http://hl7.org/fhir/issue-severity
Alias: $CodeCode = http://hl7.org/fhir/issue-type
Alias: $ActivityCode = http://medcomfhir.dk/ig/terminology/CodeSystem/medcom-messaging-activityCodes
Alias: $IssueValues = http://medcomfhir.dk/ig/terminology/ValueSet/medcom-acknowledgement-issue-details
Alias: $IssueCodes = http://medcomfhir.dk/ig/terminology/CodeSystem/medcom-acknowledgement-error-codes

---

// File: input/fsh/GeneralInstances.fsh

// deceased MedComCorePatient
Instance: 382fb8a3-6725-41e2-a615-2b1cfcfe9931
InstanceOf: MedComCorePatient
Title: "Bruno Test Elmer"
Description: "Patient described with minimal information. Valid only if used in a Bundle."
* identifier[cpr].system = "urn:oid:1.2.208.176.1.2"
* identifier[cpr].value = "2509479989"
* name[official].use = #official
* name[official].family = "Elmer"

// MedComMessagingMessage instance

Instance: eb26be85-fdb7-454d-a980-95cba6d1745b
InstanceOf: MedComMessagingMessage
Description: "Example of an emty message."
* type = $BundleType#message
* timestamp = 2020-09-28T12:34:56Z
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/MessageHeader/3881874e-2042-4a00-aee8-23512799f512"
* entry[=].resource = 3881874e-2042-4a00-aee8-23512799f512
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Organization/d7056980-a8b2-42aa-8a0e-c1fc85d1f40d"
* entry[=].resource = d7056980-a8b2-42aa-8a0e-c1fc85d1f40d
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Organization/74cdf292-abf3-4f5f-80ea-60a48013ff6d"
* entry[=].resource = 74cdf292-abf3-4f5f-80ea-60a48013ff6d
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Provenance/4c284936-5454-4116-95fc-3c8eeeed2400"
* entry[=].resource = 4c284936-5454-4116-95fc-3c8eeeed2400

// MedComMessagingMessageHeader og MedComMessagingdestinationUseExtension instance

Instance: b4e7e16b-9658-4172-acd7-5e7193f2cc5f
InstanceOf: MedComMessagingDestinationUseExtension
Usage: #inline
* valueCoding = $Use#primary

Instance: 3881874e-2042-4a00-aee8-23512799f512
InstanceOf: MedComMessagingMessageHeader
Title: "Message Header for an empty message. Valid only if used in a bundle (message)"
Description: "Message Header for an empty message. Valid only if used in a bundle (message)."
* destination[primary].extension[use] = b4e7e16b-9658-4172-acd7-5e7193f2cc5f
* eventCoding = $MessageEvents#empty-message
* destination[primary].endpoint = "https://sor2.sum.dsdn.dk/#id=953741000016009"
* destination[primary].receiver = Reference(74cdf292-abf3-4f5f-80ea-60a48013ff6d)
* sender = Reference(d7056980-a8b2-42aa-8a0e-c1fc85d1f40d)
* source.endpoint = "https://sor2.sum.dsdn.dk/#id=265161000016000"

// CareCommunication example
Instance: 42cb9200-f421-4d08-8391-7d51a2503cb4
InstanceOf: MedComMessagingMessageHeader
Title: "Message header for care communication message. Valid only if used in a bundle (message)."
Description: "Message header for care communication message. Valid only if used in a bundle (message)."
* destination[primary].extension[use] = b4e7e16b-9658-4172-acd7-5e7193f2cc5f
* eventCoding = $MessageEvents#care-communication-message
* destination[primary].endpoint = "https://sor2.sum.dsdn.dk/#id=265161000016000"
* destination[primary].receiver = Reference(74cdf292-abf3-4f5f-80ea-60a48013ff6d)
* sender = Reference(d7056980-a8b2-42aa-8a0e-c1fc85d1f40d)
* source.endpoint = "https://sor2.sum.dsdn.dk/#id=953741000016009"

//MedComMessagingOrganization instances (sender, receiver, serviceprovider)

// Reciever instance
Instance: 74cdf292-abf3-4f5f-80ea-60a48013ff6d
InstanceOf: MedComMessagingOrganization
Title: "Example of a reciever organization with a SOR and an EAN identifier."
Description: "Example of an organization with a SOR and an EAN identifier."
* identifier[SOR-ID].value = "265161000016000" 
* identifier[EAN-ID].value = "5790000209354" 
* name = "Receiver Organization"

// Sender instance
Instance: d7056980-a8b2-42aa-8a0e-c1fc85d1f40d
InstanceOf: MedComMessagingOrganization
Title: "Example of a sender organization with a SOR and an EAN identifier."
Description: "Example of an organization with a SOR and an EAN identifier."
* identifier[SOR-ID].value = "953741000016009"
* identifier[EAN-ID].value = "5790001348120"
* name = "Sender Organization"


---

// File: input/fsh/MedComAcknowledgementMessage.fsh

Profile: MedComAcknowledgementMessage
Parent: MedComMessagingMessage
Id: medcom-messaging-acknowledgement
Description: "Base resource for all MedCom Acknowledgement messages."
* obeys medcom-acknowledgement-2
* entry ^short = "Message content (MedComAcknowledgementMessageHeader, MedComMessagingProvenance, MedComMessagingOrganization) - Open"
* obeys medcom-acknowledgement-1

Invariant: medcom-acknowledgement-1
Description: "If the response.code is different than 'ok', a reference to an OperationOutcome resource shall be included."
Severity: #error
Expression: "iif(entry.resource.ofType(MessageHeader).response.code = 'ok', true, entry.resource.ofType(MessageHeader).response.code != 'ok' and entry.resource.ofType(OperationOutcome).exists())"

Invariant: medcom-acknowledgement-2
Description: "The message header shall conform to medcom-messaging-acknowledgementHeader profile"
Severity: #error
Expression: "entry.resource.ofType(MessageHeader).conformsTo('http://medcomfhir.dk/ig/acknowledgement/StructureDefinition/medcom-messaging-acknowledgementHeader')"

Instance: a8c041b8-c65a-4fde-a90f-962076918834
InstanceOf: MedComAcknowledgementMessage
Title: "Example Acknowledgement message - Ok"
Description: "Example Acknowledgement message - Ok"
* type = $BundleType#message
* timestamp = 2022-09-01T12:01:00Z
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/MessageHeader/aba2d9bf-2c6c-47e8-bce4-7928bcd51019"
* entry[=].resource = aba2d9bf-2c6c-47e8-bce4-7928bcd51019
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Provenance/4c284936-5454-4116-95fc-3c8eeeed2400"
* entry[=].resource = 4c284936-5454-4116-95fc-3c8eeeed2400
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Provenance/69dab277-dd4b-4055-9fda-a10a65cb4412"
* entry[=].resource = 69dab277-dd4b-4055-9fda-a10a65cb4412
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Organization/d7056980-a8b2-42aa-8a0e-c1fc85d1f40d"
* entry[=].resource = d7056980-a8b2-42aa-8a0e-c1fc85d1f40d
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Organization/74cdf292-abf3-4f5f-80ea-60a48013ff6d"
* entry[=].resource = 74cdf292-abf3-4f5f-80ea-60a48013ff6d

Instance: bc9535ef-ed94-4060-a928-7baddec7ee71
InstanceOf: MedComAcknowledgementMessage
Title: "Example Acknowledgement message - Fatal error"
Description: "Example Acknowledgement message - Fatal error"
* type = $BundleType#message
* timestamp = 2022-09-01T12:01:00Z
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/MessageHeader/b879c81e-0607-4ccb-b358-24a72208e30d"
* entry[=].resource = b879c81e-0607-4ccb-b358-24a72208e30d
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Provenance/4c284936-5454-4116-95fc-3c8eeeed2400"
* entry[=].resource = 4c284936-5454-4116-95fc-3c8eeeed2400
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Provenance/9c56ba88-9645-11ec-b909-0242ac120002"
* entry[=].resource = 9c56ba88-9645-11ec-b909-0242ac120002
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Organization/d7056980-a8b2-42aa-8a0e-c1fc85d1f40d"
* entry[=].resource = d7056980-a8b2-42aa-8a0e-c1fc85d1f40d
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Organization/74cdf292-abf3-4f5f-80ea-60a48013ff6d"
* entry[=].resource = 74cdf292-abf3-4f5f-80ea-60a48013ff6d
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/OperationOutcome/becb2a8e-3a68-4083-910e-811296affd43"
* entry[=].resource = becb2a8e-3a68-4083-910e-811296affd43


Instance: c9c2b2f6-0807-11ed-861d-0242ac120002
InstanceOf: MedComAcknowledgementMessage
Title: "Example Acknowledgement message - Transient error"
Description: "Example Acknowledgement message - Transient error"
* type = $BundleType#message
* timestamp = 2022-09-01T12:01:00Z
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/MessageHeader/c9a0b728-0807-11ed-861d-0242ac120002"
* entry[=].resource = c9a0b728-0807-11ed-861d-0242ac120002
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Provenance/4c284936-5454-4116-95fc-3c8eeeed2400"
* entry[=].resource = 4c284936-5454-4116-95fc-3c8eeeed2400
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Provenance/9b56aa88-9745-12ec-b919-0242ac122002"
* entry[=].resource = 9b56aa88-9745-12ec-b919-0242ac122002
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Organization/d7056980-a8b2-42aa-8a0e-c1fc85d1f40d"
* entry[=].resource = d7056980-a8b2-42aa-8a0e-c1fc85d1f40d
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/Organization/74cdf292-abf3-4f5f-80ea-60a48013ff6d"
* entry[=].resource = 74cdf292-abf3-4f5f-80ea-60a48013ff6d
* entry[+].fullUrl = "https://medcomfhir.dk/ig/acknowledgement/OperationOutcome/c0055484-2a56-4da2-81b8-a9d5087d865c"
* entry[=].resource = c0055484-2a56-4da2-81b8-a9d5087d865c

---

// File: input/fsh/MedComAcknowledgementMessageDefinition.fsh

Profile: MedComAcknowledgementMessageDefinition
Parent: MedComMessagingMessageDefinitionFhir
Id: medcom-acknowledgement-message-definition
Description: "The MessageDefinition for a MedCom Acknowledgement message"
* id = "MedComAcknowledgementMessageDefinition"
* url = "urn:dk:healthcare:medcom:messaging:fhir:structuredefinition:acknowledgement:2.0"
* identifier.period.start = "2024-06-18"
* identifier.use = #official 
* identifier.value = "Acknowledgement"
* version = "2.0"
* title = "Acknowledgement 2.0"
* status = #active
* date = "2024-09-04"
* copyright = "Copyright © 2024 MedCom"
//* publisher = "MedCom"
//InteroperabilityConsultant
* contact[InteroperabilityConsultant].name = "Thea Sørensen"
//* contact[InteroperabilityConsultant].telecom.system = #email
* contact[InteroperabilityConsultant].telecom.value = "tms@medcom.dk" 
//* contact[InteroperabilityConsultant].telecom.use = #work
* description = "DK: Acknowledgement (RUSA Standardkatalog - Beskrivelse jf. §3stk2 i bekendtgørelsen)"
* useContext.valueCodeableConcept.text = "DK: Alle sundhedsvæsnets parter der er involverede i behandling og omsorg af borgere eller patienter, herunder læger, hjemmepleje, fysioterapeuter, ergoterapeuter, plejeteam, sygeplejersker, psykologer, psykiater og mange flere. (Hvem skal anvende standarden jf. §3,3 i bekendtgørelsen)"
* purpose = "DK: At kvittere for en modtaget meddelelse samt, om overførslen af meddelelsen var vellykket, og om meddelelsen validerede korrekt eller ej. MedCom Acknowledgement standard skal sendes hver gang et system har modtaget en MedCom FHIR-meddelelse eksempelvis HospitalNotification og CareCommunication. (RUSA Standardkatalog - Hvad skal standarden anvendes til jf. §3,2 i bekendtgørelsen)"
* eventCoding = $MessageEvents#acknowledgement-message "Acknowledgement Message"
* responseRequired = #never
//* allowedResponse[+].message.value = "Eer.fhir.MessageDefinition.Acknowledgement:2.0"
//* allowedResponse[+].message.value = "http://medcomfhir.dk/ig/acknowledgement/ImplementationGuide/medcom.fhir.dk.acknowledgement"
//* allowedResponse[+].message.value = "http://medcomfhir.dk/ig/carecommunication/StructureDefinition/medcom-careCommunication-message"



---

// File: input/fsh/MedComAcknowledgementMessageHeader.fsh

Profile: MedComAcknowledgementMessageHeader
Parent: MedComMessagingMessageHeader
Id: medcom-messaging-acknowledgementHeader
Description: "A resource that describes a reponse to a message that is exchanged as a MedCom messgage within Danish healthcare"
* destination[cc] ..0
* response 1.. MS
* response.identifier MS
* response.code MS
* response.details MS
* response.details ^definition = "Shall contain identified hints/warnings/error in case the code is transient-error or fatal-error"
* response.details only Reference(MedComAcknowledgementOperationOutcome)
* source ^short = "Contains information about the sender of the Acknowledgement message"
* definition 1..1 MS
* definition = "http://medcomfhir.dk/ig/acknowledgement/medcom-acknowledgement-message-definition|2.0.0"

Instance: ff9055ec-b1f1-48b6-933a-063dff0a6faf
InstanceOf: MedComAcknowledgementMessageHeader
Title: "Acknowledgement MessageHeader -  empty message"
Description: "Acknowledgement MessageHeader - empty message. Valid only if used in a Bundle (message)."
Usage: #inline
* destination[primary].extension[use] = b4e7e16b-9658-4172-acd7-5e7193f2cc5f
* eventCoding = $MessageEvents#acknowledgement-message
* destination[primary].endpoint = "https://sor2.sum.dsdn.dk/#id=265161000016000"
* destination[primary].receiver = Reference(74cdf292-abf3-4f5f-80ea-60a48013ff6d)
* sender = Reference(d7056980-a8b2-42aa-8a0e-c1fc85d1f40d)
* source.endpoint = "https://sor2.sum.dsdn.dk/#id=953741000016009"
* response.identifier = "eb26be85-fdb7-454d-a980-95cba6d1745b"
* response.code = $AcknowledgementCode#fatal-error
* definition = "http://medcomfhir.dk/ig/acknowledgement/medcom-acknowledgement-message-definition|2.0.0"

Instance: b879c81e-0607-4ccb-b358-24a72208e30d
InstanceOf: MedComAcknowledgementMessageHeader
Title: "Acknowledgement MessageHeader - fatal-error message"
Description: "Acknowledgement MessageHeader - fatal-error message. Valid only if used in a Bundle (message)."
Usage: #example
* destination[primary].extension[use] = b4e7e16b-9658-4172-acd7-5e7193f2cc5f
* eventCoding = $MessageEvents#acknowledgement-message
* destination[primary].endpoint = "https://sor2.sum.dsdn.dk/#id=265161000016000"
* destination[primary].receiver = Reference(74cdf292-abf3-4f5f-80ea-60a48013ff6d)
* sender = Reference(d7056980-a8b2-42aa-8a0e-c1fc85d1f40d)
* source.endpoint = "https://sor2.sum.dsdn.dk/#id=953741000016009"
* response.identifier = "53128d9b-cede-4c7f-8904-809eab322d7d"
* response.code = $AcknowledgementCode#fatal-error
* response.details = Reference(becb2a8e-3a68-4083-910e-811296affd43)
* definition = "http://medcomfhir.dk/ig/acknowledgement/medcom-acknowledgement-message-definition|2.0.0"

Instance: aba2d9bf-2c6c-47e8-bce4-7928bcd51019
InstanceOf: MedComAcknowledgementMessageHeader
Title: "Acknowledgement MessageHeader -  ok message"
Description: "Acknowledgement MessageHeader - ok message. Valid only if used in a Bundle (message)."
Usage: #example
* destination[primary].extension[use] = b4e7e16b-9658-4172-acd7-5e7193f2cc5f
* eventCoding = $MessageEvents#acknowledgement-message
* destination[primary].endpoint = "https://sor2.sum.dsdn.dk/#id=265161000016000"
* destination[primary].receiver = Reference(74cdf292-abf3-4f5f-80ea-60a48013ff6d)
* sender = Reference(d7056980-a8b2-42aa-8a0e-c1fc85d1f40d)
* source.endpoint = "https://sor2.sum.dsdn.dk/#id=953741000016009"
* response.identifier = "42cb9200-f421-4d08-8391-7d51a2503cb4"
* response.code = $AcknowledgementCode#ok
* definition = "http://medcomfhir.dk/ig/acknowledgement/medcom-acknowledgement-message-definition|2.0.0"

Instance: c9a0b728-0807-11ed-861d-0242ac120002
InstanceOf: MedComAcknowledgementMessageHeader
Title: "Acknowledgement MessageHeader - transient-error message"
Description: "Acknowledgement MessageHeader - transient-error message. Valid only if used in a Bundle (message)."
Usage: #example
* destination[primary].extension[use] = b4e7e16b-9658-4172-acd7-5e7193f2cc5f
* eventCoding = $MessageEvents#acknowledgement-message
* destination[primary].endpoint = "https://sor2.sum.dsdn.dk/#id=265161000016000"
* destination[primary].receiver = Reference(74cdf292-abf3-4f5f-80ea-60a48013ff6d)
* sender = Reference(d7056980-a8b2-42aa-8a0e-c1fc85d1f40d)
* source.endpoint = "https://sor2.sum.dsdn.dk/#id=953741000016009"
* response.identifier = "53128d9b-cede-4c7f-8904-809eab322d7d"
* response.code = $AcknowledgementCode#transient-error
* response.details = Reference(c0055484-2a56-4da2-81b8-a9d5087d865c)
* definition = "http://medcomfhir.dk/ig/acknowledgement/medcom-acknowledgement-message-definition|2.0.0"


---

// File: input/fsh/MedComAcknowledgementOperationOutcome.fsh

Profile: MedComAcknowledgementOperationOutcome
Parent: OperationOutcome
Id: medcom-acknowledgement-operationoutcome
Description: "This profile provides detailed information about the outcome of an attempted system operation, such as delivering a message. It shall only be used when the attempt fails."
* issue MS
* issue.severity MS
* issue.code MS
* issue.details MS
* issue.details.coding MS
* issue.details.text MS
* issue.details.coding from $IssueValues


Instance: becb2a8e-3a68-4083-910e-811296affd43
InstanceOf: MedComAcknowledgementOperationOutcome
Title: "MedComAcknowledgementOperationOutcome - Severity is 'error'"
Description: "Example of an error operationOutcome. Valid only if used in a Bundle (message)."
Usage: #example
* issue.severity = $ServerityCode#error
* issue.code =  $CodeCode#structure
* issue.details.coding = $IssueCodes#MSG_VALUESET_VALUE_UNKNOWN	

Instance: a87bc9d4-f876-4b6f-8585-40b26dc1e369
InstanceOf: MedComAcknowledgementOperationOutcome
Title: "MedComAcknowledgementOperationOutcome - Severity is 'information'"
Description: "Example of an error operationOutcome. Valid only if used in a Bundle (message)."
Usage: #example
* issue.severity = $ServerityCode#information
* issue.code =  $CodeCode#informational
* issue.details.text = "No summary for the Patient instance."


Instance: c0055484-2a56-4da2-81b8-a9d5087d865c
InstanceOf: MedComAcknowledgementOperationOutcome
Title: "MedComAcknowledgementOperationOutcome - Severity is 'error'"
Description: "Example of an error operationOutcome. Valid only if used in a Bundle (message)."
Usage: #example
* issue.severity = $ServerityCode#error
* issue.code =  $CodeCode#value
* issue.details.coding = $IssueCodes#MSG_Mailbox_Out_Of_Operation




---

