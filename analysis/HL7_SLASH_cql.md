# cql: Analysis

## Core Purpose & Scope

This FHIR Implementation Guide (IG) defines the Clinical Quality Language (CQL) specification, a domain-specific language for expressing clinical knowledge that can be used within both Clinical Decision Support (CDS) and Clinical Quality Measurement (CQM) domains. It addresses the primary interoperability challenge of enabling the sharing and reuse of clinical logic between CDS and CQM artifacts, which traditionally use different approaches to representing patient data and computable expression logic. The IG solves the key clinical/business problems of duplicated effort in interpreting, integrating, and executing CDS and CQM artifacts, and the inability to share logic between them. The scope is focused on the common representation of expression logic, independent of any particular data model, and is intended to be used by other specifications that address metadata and data model aspects of quality artifacts.

## Technical Foundation

The technical foundation of CQL rests on the Expression Logical Model (ELM), a syntax-independent, canonical representation of logic based on compiler design best practices. ELM is serialized in XML or JSON. The IG defines a high-level, domain-specific language (CQL) targeted at measure and decision support artifact authors, which can be rendered in the canonical ELM representation. Key technical building blocks include:

-   **Core profiles and extensions:** Not applicable, as this IG focuses on a language specification rather than FHIR resource profiles.
-   **Notable operations and interactions:** The IG defines a comprehensive set of operators for arithmetic, string manipulation, date/time operations, interval operations, list operations, logical operations, null handling, type testing, and type conversion. It also defines query constructs for filtering, shaping, and sorting data.
-   **Key terminology and value sets:** The IG supports the use of external terminologies through `codesystem`, `valueset`, `code`, and `concept` declarations. It does not define specific value sets but provides examples using SNOMED CT, LOINC, ICD-10-CM, and others.
-   **Significant patterns and constraints:** The IG emphasizes the separation of concerns between metadata, clinical information, and expression logic. It promotes the use of libraries to share common logic and defines a clear structure for libraries, including declarations for data models, included libraries, terminology, parameters, context, and named expressions.

## Technical Essence

This IG defines CQL and its underlying ELM as a data-model-agnostic language for expressing clinical logic.  CQL syntax supports retrieves, queries with `where`, `return`, `sort by`, `with`, and `without` clauses, and a rich set of operators.  ELM provides an abstract syntax tree representation of CQL logic, serializable in XML or JSON.  A CQL library encapsulates declarations for data models (`using`), included libraries (`include`), terminology (`codesystem`, `valueset`, `code`, `concept`), parameters (`parameter`), context (`context`), and named expressions/functions (`define`).  Data model independence is achieved by requiring a data model description that maps model-specific types and attributes to CQL's concepts.  Libraries can be versioned and referenced by other libraries or external artifacts.  CQL expressions are evaluated within a defined context (e.g., `Patient`, `Unfiltered`).  The language supports a comprehensive set of operators, including arithmetic, string, date/time, interval, list, logical, and nullological operations, with well-defined semantics for handling missing data (nulls).  Type checking, inference, conversion, and casting rules are specified.  Functions can be defined, including external functions for integration with external systems.  A translator converts CQL to ELM, handling operator precedence, type inference, implicit conversions, and validations.

## Implementation Approach

The IG is meant to be implemented by building language processing applications for artifacts based on the CQL specification, such as translators, interpreters, and tooling. Implementers need to support the translation between CQL and ELM, as defined in the specification. They also need to provide a data layer integration that maps the data model in use to the constructs of CQL, enabling the evaluation of retrieves and queries. The IG specifies the intended execution semantics, including the handling of nulls, three-valued logic, and date/time operations. Implementations should respect the defined operator precedence and type checking rules. The IG provides guidance on handling missing information and uncertainties.

## Ecosystem Context

The target systems for this IG include health IT vendors, quality agencies, quality artifact authors and consumers, and any party interested in producing or consuming health quality artifacts. The target users are clinical domain experts, clinical artifact authors, developers, integrators, systems analysts, and architects. The IG is related to other HL7 specifications, including HQMF, the CDS Knowledge Artifact Specification, FHIR, and FHIRPath. It is particularly relevant to the Clinical Reasoning Module of FHIR. The IG was initially developed under the Clinical Quality Framework (CQF) initiative, sponsored by CMS and ONC, and is now maintained by the HL7 CDS Work Group, co-sponsored by the CQI Work Group. The primary use cases are the representation and sharing of clinical quality knowledge for both decision support and quality measurement, enabling a learning health system.
